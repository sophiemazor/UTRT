var jsPsychPreload=function(r){"use strict";var w="2.1.0";const R={name:"preload",version:w,parameters:{auto_preload:{type:r.ParameterType.BOOL,default:!1},trials:{type:r.ParameterType.TIMELINE,default:[]},images:{type:r.ParameterType.STRING,default:[],array:!0},audio:{type:r.ParameterType.STRING,default:[],array:!0},video:{type:r.ParameterType.STRING,default:[],array:!0},message:{type:r.ParameterType.HTML_STRING,default:null},show_progress_bar:{type:r.ParameterType.BOOL,default:!0},continue_after_error:{type:r.ParameterType.BOOL,default:!1},error_message:{type:r.ParameterType.HTML_STRING,default:"The experiment failed to load."},show_detailed_errors:{type:r.ParameterType.BOOL,default:!1},max_load_time:{type:r.ParameterType.INT,default:null},on_error:{type:r.ParameterType.FUNCTION,default:null},on_success:{type:r.ParameterType.FUNCTION,default:null}},data:{success:{type:r.ParameterType.BOOL},timeout:{type:r.ParameterType.BOOL},failed_images:{type:r.ParameterType.STRING,array:!0},failed_audio:{type:r.ParameterType.STRING,array:!0},failed_video:{type:r.ParameterType.STRING,array:!0}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class I{constructor(o){this.jsPsych=o}trial(o,e){var t=null,u=!1,L=[],O=[],j=[],g=[],x=this.jsPsych.getSafeModeStatus(),s=[],l=[],i=[];if(e.auto_preload){var E=this.jsPsych.getTimeline(),y=this.jsPsych.pluginAPI.getAutoPreloadList(E);s=s.concat(y.images),l=l.concat(y.audio),i=i.concat(y.video)}if(e.trials.length>0){var f=this.jsPsych.pluginAPI.getAutoPreloadList(e.trials);s=s.concat(f.images),l=l.concat(f.audio),i=i.concat(f.video)}s=s.concat(e.images),l=l.concat(e.audio),i=i.concat(e.video),s=this.jsPsych.utils.unique(s.flat()),l=this.jsPsych.utils.unique(l.flat()),i=this.jsPsych.utils.unique(i.flat()),x&&(i=[]);var P="";e.message!==null&&(P+=e.message),e.show_progress_bar&&(P+=`
            <div id='jspsych-loading-progress-bar-container' style='height: 10px; width: 300px; background-color: #ddd; margin: auto;'>
              <div id='jspsych-loading-progress-bar' style='height: 10px; width: 0%; background-color: #777;'></div>
            </div>`),o.innerHTML=P;const A=()=>{if(m++,e.show_progress_bar){var a=m/c*100,n=o.querySelector("#jspsych-loading-progress-bar");n!==null&&(n.style.width=a+"%")}},S=()=>{typeof u!="undefined"&&u===!1&&(this.jsPsych.pluginAPI.clearAllTimeouts(),this.jsPsych.pluginAPI.cancelPreloads(),t=!0,p())},G=()=>{this.jsPsych.pluginAPI.cancelPreloads(),typeof t!="undefined"&&(t===!1||t===null)&&(u=!0,T<c&&(t=!1),N("timeout"),g.push("<p><strong>Loading timed out.</strong><br>Consider compressing your stimuli files, loading your files in smaller batches,<br>and/or increasing the <i>max_load_time</i> parameter.</p>"),e.continue_after_error?p():_())},_=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),this.jsPsych.pluginAPI.cancelPreloads(),o.innerHTML=e.error_message,e.show_detailed_errors&&(o.innerHTML+="<p><strong>Error details:</strong></p>",g.forEach(a=>{o.innerHTML+=a}))},p=()=>{var a={success:t,timeout:u,failed_images:L,failed_audio:O,failed_video:j};this.jsPsych.finishTrial(a)};e.max_load_time!==null&&this.jsPsych.pluginAPI.setTimeout(G,e.max_load_time);var c=s.length+l.length+i.length,m=0,T=0;if(c==0)S();else{const a=h=>{this.jsPsych.pluginAPI.preloadVideo(i,h,v,b)},n=h=>{this.jsPsych.pluginAPI.preloadAudio(l,h,v,b)},d=h=>{this.jsPsych.pluginAPI.preloadImages(s,h,v,b)};i.length>0&&a(()=>{}),l.length>0&&n(()=>{}),s.length>0&&d(()=>{})}function b(a){A(),t==null&&(t=!1);var n="unknown file";a.source&&(n=a.source),a.error&&a.error.path&&a.error.path.length>0&&(a.error.path[0].localName=="img"?L.push(n):a.error.path[0].localName=="audio"?O.push(n):a.error.path[0].localName=="video"&&j.push(n));var d="<p><strong>Error loading file: "+n+"</strong><br>";a.error.statusText&&(d+="File request response status: "+a.error.statusText+"<br>"),a.error=="404"&&(d+="404 - file not found.<br>"),typeof a.error.loaded!="undefined"&&a.error.loaded!==null&&a.error.loaded!==0?d+=a.error.loaded+" bytes transferred.":d+="File did not begin loading. Check that file path is correct and reachable by the browser,<br>and that loading is not blocked by cross-origin resource sharing (CORS) errors.",d+="</p>",g.push(d),N(n),m==c&&(e.continue_after_error?p():_())}function v(a){A(),B(a),T++,T==c?S():m==c&&(e.continue_after_error?p():_())}function N(a){e.on_error!==null&&e.on_error(a)}function B(a){e.on_success!==null&&e.on_success(a)}}simulate(o,e,t,u){e=="data-only"&&(u(),this.simulate_data_only(o,t)),e=="visual"&&this.simulate_visual(o,t,u)}create_simulation_data(o,e){const t={success:!0,timeout:!1,failed_images:[],failed_audio:[],failed_video:[]};return this.jsPsych.pluginAPI.mergeSimulationData(t,e)}simulate_data_only(o,e){const t=this.create_simulation_data(o,e);this.jsPsych.finishTrial(t)}simulate_visual(o,e,t){const u=this.jsPsych.getDisplayElement();this.trial(u,o),t()}}return I.info=R,I}(jsPsychModule);
//# sourceMappingURL=https://unpkg.com/@jspsych/plugin-preload@2.1.0/dist/index.browser.min.js.map
